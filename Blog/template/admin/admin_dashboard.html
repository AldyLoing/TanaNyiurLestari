{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-center mb-4 fw-bold" style="color: #2c3e50;">ðŸ“Š Dasbor Admin</h2>

    <!-- Baris untuk Statistik Utama -->
    <div class="row row-cols-1 row-cols-md-5 g-4 mb-4">
        <div class="col">
            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #3498db, #2980b9); border-radius: 15px;">
                <div class="card-body text-center text-white p-3">
                    <div class="icon-stat mb-3">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                    <h5 class="card-title mb-2">Total Nasabah</h5>
                    <p class="fs-3 fw-bold mb-0">{{ total_users }}</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #2ecc71, #27ae60); border-radius: 15px;">
                <div class="card-body text-center text-white p-3">
                    <div class="icon-stat mb-3">
                        <i class="fas fa-recycle fa-2x"></i>
                    </div>
                    <h5 class="card-title mb-2">Total Sampah Terkumpul</h5>
                    <p class="fs-3 fw-bold mb-0">{{ total_waste }} kg</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #f39c12, #e67e22); border-radius: 15px;">
                <div class="card-body text-center text-white p-3">
                    <div class="icon-stat mb-3">
                        <i class="fas fa-coins fa-2x"></i>
                    </div>
                    <h5 class="card-title mb-2">Total Poin Dibagikan</h5>
                    <p class="fs-3 fw-bold mb-0">{{ total_points }} pts</p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #e74c3c, #c0392b); border-radius: 15px;">
                <div class="card-body text-center text-white p-3">
                    <div class="icon-stat mb-3">
                        <i class="fas fa-gift fa-2x"></i>
                    </div>
                    <h5 class="card-title mb-2">Total Poin Ditukar</h5>
                    <p class="fs-3 fw-bold mb-0">
                        {% if total_redeemed_points %}
                            {{ total_redeemed_points }} pts
                        {% else %}
                            0 pts
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #9b59b6, #8e44ad); border-radius: 15px;">
                <div class="card-body text-center text-white p-3">
                    <div class="icon-stat mb-3">
                        <i class="fas fa-tasks fa-2x"></i>
                    </div>
                    <h5 class="card-title mb-2">Tugas Tertunda</h5>
                    <p class="fs-3 fw-bold mb-0">{{ pending_tasks }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bagian Grafik -->
    <div class="row mt-3">
        <div class="col-12 col-md-6 mb-4">
            <div class="card border-0 shadow-sm h-100" style="border-radius: 15px;">
                <div class="card-header bg-white border-0 pt-3" style="border-radius: 15px 15px 0 0;">
                    <h5 class="card-title fw-bold text-center" style="color: #2c3e50;">
                        <i class="fas fa-calendar-alt me-2"></i>Statistik Pengumpulan Sampah Bulanan
                    </h5>
                </div>
                <div class="card-body pb-3">
                    <canvas id="wasteChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6 mb-4">
            <div class="card border-0 shadow-sm h-100" style="border-radius: 15px;">
                <div class="card-header bg-white border-0 pt-3" style="border-radius: 15px 15px 0 0;">
                    <h5 class="card-title fw-bold text-center" style="color: #2c3e50;">
                        <i class="fas fa-chart-pie me-2"></i>Pengumpulan Sampah per Kategori
                    </h5>
                </div>
                <div class="card-body pb-3">
                    <canvas id="categoryChart" style="max-height: 300px;"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Sertakan Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var months = JSON.parse('{{ months_json|escapejs }}');
        var wasteData = JSON.parse('{{ waste_data_json|escapejs }}');
        var categories = JSON.parse('{{ categories_json|escapejs }}');
        var categoryWeights = JSON.parse('{{ category_weights_json|escapejs }}');

        // Grafik Statistik Pengumpulan Sampah Bulanan
        var ctx1 = document.getElementById('wasteChart').getContext('2d');
        new Chart(ctx1, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [{
                    label: 'Total Sampah (kg)',
                    data: wasteData,
                    backgroundColor: 'rgba(46, 204, 113, 0.7)',
                    borderColor: 'rgba(39, 174, 96, 1)',
                    borderWidth: 1,
                    borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: { 
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });

        // Grafik Pengumpulan Sampah per Kategori
        var ctx2 = document.getElementById('categoryChart').getContext('2d');
        new Chart(ctx2, {
            type: 'doughnut',
            data: {
                labels: categories,
                datasets: [{
                    label: 'Total Sampah per Kategori (kg)',
                    data: categoryWeights,
                    backgroundColor: [
                        'rgba(231, 76, 60, 0.7)',
                        'rgba(52, 152, 219, 0.7)',
                        'rgba(241, 196, 15, 0.7)',
                        'rgba(46, 204, 113, 0.7)',
                        'rgba(155, 89, 182, 0.7)'
                    ],
                    borderColor: [
                        'rgba(231, 76, 60, 1)',
                        'rgba(52, 152, 219, 1)',
                        'rgba(241, 196, 15, 1)',
                        'rgba(46, 204, 113, 1)',
                        'rgba(155, 89, 182, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right'
                    }
                },
                cutout: '65%'
            }
        });
    });
</script>

<style>
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #f5f7fa;
    }
    .icon-stat {
        width: 50px;
        height: 50px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
    }
    
    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
    }
</style>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

{% endblock %}